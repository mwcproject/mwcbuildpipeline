#!/usr/bin/expect

set file [lindex $argv 0];
set pass [lindex $argv 1];

# Don't timeout; let rsync run as long as it needs
set timeout -1

# spawn scp -o StrictHostKeyChecking=no $file uploader@ftp.mwc.mw:/home/uploader
# Switching to rsync because it can continue the session
spawn rsync -e ssh -av --progress --partial $file uploader@ftp.mwc.mw:/home/uploader

expect {
    -re "(?i)yes/no"     { send "yes\r"; exp_continue }
    -re "(?i)password:"  { send "$pass\r"; exp_continue }
    eof
}
